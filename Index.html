<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#050b14">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>EA BOT STUDIO | สร้างและเก็บโค้ด</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Kanit:wght@200;300;400;500;600;700;800&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Kanit', 'sans-serif'], 
                        code: ['JetBrains Mono', 'monospace'],
                        display: ['Orbitron', 'sans-serif']
                    },
                    colors: { 
                        brand: { 
                            bg: '#050b14', 
                            card: '#0f172a', 
                            primary: '#d946ef', // Pink
                            secondary: '#8b5cf6', // Violet
                            accent: '#06b6d4', // Cyan
                            code: '#1e1e1e' // VS Code dark
                        } 
                    },
                    animation: { 
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'float': 'float 4s ease-in-out infinite'
                    },
                    keyframes: {
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 5px #d946ef' }, '50%': { boxShadow: '0 0 25px #d946ef' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }
                    }
                }
            }
        }
    </script>

    <style>
        /* Base */
        body { 
            background-color: #050b14; 
            color: #e2e8f0; 
            overflow-x: hidden; 
            -webkit-tap-highlight-color: transparent; 
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #d946ef; }

        /* Background */
        .bg-cyber { 
            position: fixed; inset: 0; z-index: -2; 
            background: radial-gradient(circle at 50% 0%, #2e1065 0%, #050b14 80%); 
        }
        .bg-grid { 
            position: fixed; inset: 0; z-index: -1; 
            background-image: linear-gradient(rgba(217, 70, 239, 0.03) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(217, 70, 239, 0.03) 1px, transparent 1px); 
            background-size: 40px 40px; 
            mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
        }

        /* Glass Components */
        .glass-card { 
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.95)); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            border-radius: 20px; 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            border-color: rgba(217, 70, 239, 0.3);
            transform: translateY(-2px);
        }

        .glass-nav { 
            background: rgba(15, 23, 42, 0.95); 
            backdrop-filter: blur(20px); 
            border-bottom: 1px solid rgba(255,255,255,0.05); 
        }

        /* Inputs */
        .input-cyber { 
            width: 100%; background: rgba(0, 0, 0, 0.4); 
            border: 1px solid #4c1d95; padding: 14px 20px; 
            border-radius: 12px; color: white; outline: none; transition: 0.3s; 
        }
        .input-cyber:focus { 
            border-color: #d946ef; 
            background: rgba(217, 70, 239, 0.05); 
            box-shadow: 0 0 15px rgba(217, 70, 239, 0.1); 
        }

        /* Buttons */
        .btn-gradient { 
            background: linear-gradient(135deg, #d946ef, #8b5cf6); 
            color: white; font-weight: 700; border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(217, 70, 239, 0.3); 
            transition: 0.3s; position: relative; overflow: hidden;
        }
        .btn-gradient:hover { 
            box-shadow: 0 6px 25px rgba(217, 70, 239, 0.5); 
            transform: translateY(-2px);
        }
        .btn-gradient:active { transform: scale(0.97); }

        /* Code Editor Area */
        .code-editor-container {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #334155;
            background-color: #1e1e1e;
        }
        .code-header {
            background: #252526;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        .code-dots { display: flex; gap: 6px; }
        .code-dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot-red { background: #ff5f56; }
        .dot-yellow { background: #ffbd2e; }
        .dot-green { background: #27c93f; }

        .code-textarea {
            width: 100%;
            min-height: 400px;
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            padding: 16px;
            border: none;
            outline: none;
            resize: vertical;
            white-space: pre;
            overflow-x: auto;
        }
        /* Custom selection color */
        .code-textarea::selection { background: #264f78; }

        /* FAB (Floating Action Button) */
        .fab {
            position: fixed; bottom: 30px; right: 30px;
            width: 60px; height: 60px;
            background: linear-gradient(135deg, #d946ef, #8b5cf6);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 24px;
            box-shadow: 0 10px 30px rgba(217, 70, 239, 0.4);
            cursor: pointer; transition: 0.3s;
            z-index: 50; animation: pulse-glow 3s infinite;
        }
        .fab:hover { transform: scale(1.1) rotate(90deg); }

        /* Full Page Overlay */
        .full-page { 
            position: fixed; inset: 0; background: #050b14; z-index: 100; 
            display: none; flex-direction: column; overflow-y: auto; 
            padding-bottom: 50px;
        }
        .slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    </style>
</head>
<body>

    <div class="bg-cyber"></div>
    <div class="bg-grid"></div>

    <div id="view-auth" class="fixed inset-0 z-[200] flex items-center justify-center p-6 bg-[#050b14]">
        <div class="w-full max-w-sm glass-card p-8 shadow-2xl animate__animated animate__zoomIn">
            <div class="text-center mb-10">
                <div class="inline-block relative animate-float">
                    <div class="absolute inset-0 bg-pink-500 blur-3xl opacity-20"></div>
                    <h1 class="text-6xl font-black font-display text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 relative z-10">EA BOT</h1>
                </div>
                <p class="text-slate-400 text-xs font-bold tracking-[0.3em] uppercase mt-2">PLATFORM</p>
                <p class="text-pink-300 text-xs mt-1">สร้างและเก็บโค้ดบอทของคุณ</p>
            </div>
            
            <div id="login-form" class="space-y-5">
                <div class="relative">
                    <i class="fa-solid fa-envelope absolute left-4 top-4 text-slate-500"></i>
                    <input id="l-email" class="input-cyber pl-12" placeholder="อีเมล (Email)">
                </div>
                <div class="relative">
                    <i class="fa-solid fa-lock absolute left-4 top-4 text-slate-500"></i>
                    <input id="l-pass" type="password" class="input-cyber pl-12" placeholder="รหัสผ่าน (Password)">
                </div>
                <button onclick="Auth.login()" class="btn-gradient w-full py-3.5 text-lg shadow-lg">เข้าสู่ระบบ</button>
                <div class="text-center pt-2">
                    <button onclick="UI.toggleAuth('reg')" class="text-slate-400 text-sm hover:text-pink-400 transition font-bold">สมัครสมาชิกใหม่</button>
                </div>
            </div>

            <div id="reg-form" class="space-y-5 hidden">
                <div class="relative">
                    <i class="fa-solid fa-user absolute left-4 top-4 text-slate-500"></i>
                    <input id="r-nick" class="input-cyber pl-12" placeholder="ชื่อผู้ใช้ (Display Name)">
                </div>
                <div class="relative">
                    <i class="fa-solid fa-envelope absolute left-4 top-4 text-slate-500"></i>
                    <input id="r-email" class="input-cyber pl-12" placeholder="อีเมล">
                </div>
                <div class="relative">
                    <i class="fa-solid fa-lock absolute left-4 top-4 text-slate-500"></i>
                    <input id="r-pass" type="password" class="input-cyber pl-12" placeholder="รหัสผ่าน (6+ ตัว)">
                </div>
                <button onclick="Auth.register()" class="btn-gradient w-full py-3.5 from-pink-600 to-purple-600">ยืนยันการสมัคร</button>
                <button onclick="UI.toggleAuth('log')" class="w-full text-slate-500 text-sm mt-2 hover:text-white">กลับไปหน้าล็อกอิน</button>
            </div>
        </div>
    </div>

    <div id="view-app" class="hidden flex flex-col h-screen">
        
        <nav class="sticky top-0 z-40 glass-nav px-6 py-4 flex justify-between items-center shadow-xl">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-purple-600 rounded-xl flex items-center justify-center font-black text-white text-2xl shadow-lg rotate-3">
                    EA
                </div>
                <div>
                    <div class="font-black text-xl leading-none font-display tracking-wide text-white">EA STUDIO</div>
                    <div class="text-[10px] text-pink-400 font-bold tracking-widest mt-1">CODE GENERATOR</div>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right hidden md:block">
                    <div class="text-xs text-slate-400 font-bold uppercase" id="u-email-display">user@email.com</div>
                    <div class="text-sm font-bold text-white" id="u-name-display">Username</div>
                </div>
                <button onclick="Auth.logout()" class="w-10 h-10 rounded-xl bg-slate-800 border border-slate-700 flex items-center justify-center text-red-400 hover:bg-red-500 hover:text-white transition">
                    <i class="fa-solid fa-power-off"></i>
                </button>
            </div>
        </nav>

        <main class="flex-1 overflow-y-auto p-6 md:p-10 relative">
            
            <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-white mb-2">โปรเจกต์ของฉัน</h2>
                    <p class="text-slate-400 text-sm">จัดการโค้ดบอท EA ทั้งหมดของคุณได้ที่นี่</p>
                </div>
                <div class="relative w-full md:w-64">
                    <i class="fa-solid fa-search absolute left-4 top-3.5 text-slate-500"></i>
                    <input id="search-bot" onkeyup="BotSystem.filter()" class="input-cyber pl-10 py-3 text-sm" placeholder="ค้นหาชื่อบอท...">
                </div>
            </div>

            <div id="bot-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20">
                <div class="col-span-full py-20 text-center text-slate-500 animate-pulse">
                    <i class="fa-solid fa-code text-6xl mb-4 opacity-20"></i><br>
                    กำลังโหลดข้อมูล...
                </div>
            </div>

        </main>

        <button onclick="UI.openEditor()" class="fab" title="สร้างบอทใหม่">
            <i class="fa-solid fa-plus"></i>
        </button>

    </div>

    <div id="view-editor" class="full-page bg-[#050b14]">
        <div class="glass-nav px-6 py-4 flex justify-between items-center sticky top-0 z-50">
            <button onclick="UI.closeEditor()" class="flex items-center gap-2 text-slate-400 hover:text-white transition">
                <i class="fa-solid fa-chevron-left"></i> <span class="font-bold">ย้อนกลับ</span>
            </button>
            <h1 class="text-xl font-bold text-white font-display tracking-widest">CODE EDITOR</h1>
            <div class="w-20"></div> </div>

        <div class="p-6 max-w-5xl mx-auto w-full">
            
            <input type="hidden" id="edit-id"> <div class="mb-6">
                <label class="text-xs text-pink-400 font-bold uppercase tracking-wider mb-2 block">ชื่อโปรเจกต์ (Bot Name)</label>
                <input id="bot-name" class="input-cyber text-lg font-bold" placeholder="ตั้งชื่อบอทของคุณ... (เช่น MA Crossover V1)">
            </div>

            <div class="mb-6">
                <div class="flex justify-between items-end mb-2">
                    <label class="text-xs text-purple-400 font-bold uppercase tracking-wider">Source Code</label>
                    <div class="flex gap-2">
                        <button onclick="BotSystem.copyCode()" class="bg-slate-800 text-slate-300 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-slate-700 border border-slate-700 transition flex items-center gap-2">
                            <i class="fa-regular fa-copy"></i> คัดลอกทั้งหมด
                        </button>
                        <button onclick="document.getElementById('code-input').value=''" class="bg-slate-800 text-red-400 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-red-900/20 border border-slate-700 transition">
                            <i class="fa-solid fa-trash"></i> ล้าง
                        </button>
                    </div>
                </div>

                <div class="code-editor-container shadow-2xl">
                    <div class="code-header">
                        <div class="code-dots">
                            <div class="code-dot dot-red"></div>
                            <div class="code-dot dot-yellow"></div>
                            <div class="code-dot dot-green"></div>
                        </div>
                        <div class="text-[10px] text-slate-500 font-mono">main.mq4</div>
                    </div>
                    <textarea id="code-input" class="code-textarea custom-scrollbar" placeholder="// เขียนโค้ดของคุณที่นี่...
// ตัวอย่าง:
int start() {
    double ma = iMA(NULL, 0, 14, 0, MODE_SMA, PRICE_CLOSE, 0);
    if (Ask > ma) {
        OrderSend(Symbol(), OP_BUY, 0.1, Ask, 3, 0, 0, 'My EA', 12345, 0, Green);
    }
    return(0);
}"></textarea>
                </div>
                <p class="text-xs text-slate-500 mt-2 text-right">*รองรับการพิมพ์หลายบรรทัด (Multi-line Support)</p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="UI.closeEditor()" class="py-4 rounded-xl border border-slate-700 text-slate-400 font-bold hover:bg-slate-800 transition">ยกเลิก</button>
                <button onclick="BotSystem.save()" class="btn-gradient py-4 text-lg shadow-xl shadow-purple-500/20">
                    <i class="fa-solid fa-save mr-2"></i> บันทึกโปรเจกต์
                </button>
            </div>

            <div id="delete-btn-container" class="mt-8 text-center hidden">
                <button onclick="BotSystem.delete()" class="text-red-500 text-sm hover:underline hover:text-red-400 transition">
                    <i class="fa-solid fa-trash-can mr-1"></i> ลบโปรเจกต์นี้ถาวร
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const firebaseConfig = { apiKey: "AIzaSyAHAkBhypqyJuuL22tLrFKN7ZqdEsqGDTk", authDomain: "rsdm-9ca2a.firebaseapp.com", projectId: "rsdm-9ca2a", storageBucket: "rsdm-9ca2a.firebasestorage.app", messagingSenderId: "299212700124", appId: "1:299212700124:web:730160dae6bb1b09cbb719" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); 
        const db = firebase.firestore();

        let currentUser = null;
        let allBots = [];

        // --- UI CONTROLLER ---
        const UI = {
            toggleAuth: (mode) => {
                document.getElementById('login-form').style.display = mode === 'reg' ? 'none' : 'block';
                document.getElementById('reg-form').style.display = mode === 'reg' ? 'block' : 'none';
            },
            
            toast: (msg, icon = 'success') => {
                Swal.fire({
                    toast: true, position: 'top-end', icon: icon, title: msg,
                    showConfirmButton: false, timer: 2000,
                    background: '#1e293b', color: '#fff',
                    customClass: { popup: 'rounded-xl border border-slate-700' }
                });
            },

            openEditor: (botId = null) => {
                const view = document.getElementById('view-editor');
                view.style.display = 'flex';
                view.classList.add('slide-up');
                
                // Reset Fields
                document.getElementById('bot-name').value = '';
                document.getElementById('code-input').value = '';
                document.getElementById('edit-id').value = '';
                document.getElementById('delete-btn-container').classList.add('hidden');

                if (botId) {
                    // Edit Mode
                    const bot = allBots.find(b => b.id === botId);
                    if (bot) {
                        document.getElementById('bot-name').value = bot.name;
                        document.getElementById('code-input').value = bot.code;
                        document.getElementById('edit-id').value = bot.id;
                        document.getElementById('delete-btn-container').classList.remove('hidden');
                    }
                }
            },

            closeEditor: () => {
                const view = document.getElementById('view-editor');
                view.style.display = 'none';
                view.classList.remove('slide-up');
            }
        };

        // --- AUTHENTICATION ---
        const Auth = {
            login: () => {
                const email = document.getElementById('l-email').value;
                const pass = document.getElementById('l-pass').value;
                if(!email || !pass) return UI.toast('กรุณากรอกข้อมูล', 'warning');
                auth.signInWithEmailAndPassword(email, pass).catch(e => UI.toast(e.message, 'error'));
            },
            
            register: () => {
                const nick = document.getElementById('r-nick').value;
                const email = document.getElementById('r-email').value;
                const pass = document.getElementById('r-pass').value;
                
                if(!nick || !email || !pass) return UI.toast('กรุณากรอกข้อมูลให้ครบ', 'warning');
                
                auth.createUserWithEmailAndPassword(email, pass).then(cred => {
                    db.collection('users').doc(cred.user.uid).set({
                        nickname: nick,
                        email: email,
                        uid: cred.user.uid,
                        createdAt: new Date()
                    });
                    UI.toast('สมัครสมาชิกสำเร็จ!');
                }).catch(e => UI.toast(e.message, 'error'));
            },
            
            logout: () => auth.signOut()
        };

        // --- BOT SYSTEM LOGIC ---
        const BotSystem = {
            init: () => {
                // Realtime Listener for Bots
                db.collection('ea_bots')
                  .where('uid', '==', currentUser.uid)
                  .onSnapshot(snapshot => {
                      allBots = [];
                      snapshot.forEach(doc => allBots.push({ id: doc.id, ...doc.data() }));
                      
                      // Sort by timestamp desc (Newest first)
                      allBots.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                      
                      BotSystem.renderList();
                  }, error => {
                      console.log("Error loading bots:", error);
                      // Fallback if index error: Load without sort
                      document.getElementById('bot-list').innerHTML = '<div class="col-span-full text-center text-slate-500">โหลดข้อมูลไม่สำเร็จ (ตรวจสอบ Index)</div>';
                  });
            },

            renderList: () => {
                const list = document.getElementById('bot-list');
                const search = document.getElementById('search-bot').value.toLowerCase();
                
                const filtered = allBots.filter(b => b.name.toLowerCase().includes(search));

                if (filtered.length === 0) {
                    list.innerHTML = `
                        <div class="col-span-full text-center py-20 opacity-50">
                            <i class="fa-solid fa-robot text-6xl mb-4 text-slate-600"></i>
                            <p class="text-slate-400">ไม่พบโปรเจกต์บอท</p>
                            <button onclick="UI.openEditor()" class="text-pink-400 text-sm mt-2 hover:underline">สร้างใหม่เลย!</button>
                        </div>
                    `;
                    return;
                }

                list.innerHTML = filtered.map(b => {
                    const date = b.timestamp ? new Date(b.timestamp.toDate()).toLocaleDateString('th-TH') : 'N/A';
                    const codePreview = b.code.slice(0, 100) + '...';
                    
                    return `
                        <div onclick="UI.openEditor('${b.id}')" class="glass-card p-5 cursor-pointer group hover:border-pink-500 transition relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-pink-500/10 to-transparent rounded-bl-full pointer-events-none"></div>
                            
                            <div class="flex justify-between items-start mb-3">
                                <div class="w-12 h-12 bg-slate-800 rounded-xl flex items-center justify-center text-2xl group-hover:scale-110 transition duration-300 text-pink-500 shadow-lg">
                                    <i class="fa-solid fa-code"></i>
                                </div>
                                <span class="text-[10px] text-slate-500 font-mono border border-slate-700 px-2 py-1 rounded-full">${date}</span>
                            </div>

                            <h3 class="text-lg font-bold text-white mb-2 truncate pr-4 group-hover:text-pink-400 transition">${b.name}</h3>
                            
                            <div class="bg-[#0a0a0f] p-3 rounded-lg border border-slate-800 mb-3">
                                <p class="text-xs text-slate-500 font-mono h-10 overflow-hidden opacity-70 leading-relaxed">${codePreview}</p>
                            </div>

                            <div class="flex justify-between items-center pt-2 border-t border-white/5">
                                <span class="text-xs text-slate-400 group-hover:text-white transition">คลิกเพื่อแก้ไข</span>
                                <i class="fa-solid fa-arrow-right text-slate-600 group-hover:text-pink-500 transition -translate-x-2 group-hover:translate-x-0"></i>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            filter: () => {
                BotSystem.renderList();
            },

            save: () => {
                const id = document.getElementById('edit-id').value;
                const name = document.getElementById('bot-name').value;
                const code = document.getElementById('code-input').value;

                if (!name || !code) return UI.toast('กรุณากรอกชื่อและโค้ด', 'warning');

                const data = {
                    uid: currentUser.uid,
                    name: name,
                    code: code,
                    timestamp: new Date()
                };

                if (id) {
                    // Update
                    db.collection('ea_bots').doc(id).update(data)
                        .then(() => { UI.toast('อัปเดตเรียบร้อย'); UI.closeEditor(); });
                } else {
                    // Create
                    db.collection('ea_bots').add(data)
                        .then(() => { UI.toast('สร้างบอทใหม่แล้ว'); UI.closeEditor(); });
                }
            },

            delete: () => {
                const id = document.getElementById('edit-id').value;
                if (!id) return;
                
                Swal.fire({
                    title: 'ยืนยันการลบ?',
                    text: "ข้อมูลจะหายไปถาวร ไม่สามารถกู้คืนได้",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#334155',
                    confirmButtonText: 'ใช่, ลบเลย',
                    background: '#1e293b',
                    color: '#fff'
                }).then((result) => {
                    if (result.isConfirmed) {
                        db.collection('ea_bots').doc(id).delete()
                            .then(() => { UI.toast('ลบเรียบร้อย'); UI.closeEditor(); });
                    }
                });
            },

            copyCode: () => {
                const code = document.getElementById('code-input');
                code.select();
                code.setSelectionRange(0, 99999);
                navigator.clipboard.writeText(code.value).then(() => {
                    UI.toast('คัดลอกโค้ดแล้ว!');
                });
            }
        };

        // --- MAIN INITIALIZATION ---
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                
                // Get User Info
                db.collection('users').doc(user.uid).get().then(doc => {
                    const userData = doc.exists ? doc.data() : { nickname: 'User' };
                    document.getElementById('u-name-display').innerText = userData.nickname;
                    document.getElementById('u-email-display').innerText = user.email;
                });

                document.getElementById('view-auth').classList.add('hidden');
                document.getElementById('view-app').classList.remove('hidden');
                
                BotSystem.init();
            } else {
                document.getElementById('view-auth').classList.remove('hidden');
                document.getElementById('view-app').classList.add('hidden');
            }
        });

    </script>
</body>
</html>
