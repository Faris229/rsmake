<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #ffffff; color: #1f2937; }
        .input-box { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 12px; transition: 0.2s; }
        .input-box:focus { background: #fff; border-color: #2563eb; outline: none; ring: 2px solid #eff6ff; }
        .btn-primary { background: #111827; color: white; border-radius: 12px; transition: 0.2s; }
        .btn-primary:hover { background: #000; transform: translateY(-1px); }
        
        /* Timeline Status */
        .step-item { position: relative; display: flex; flex-direction: column; align-items: center; flex: 1; }
        .step-item::before { content: ''; position: absolute; top: 15px; left: -50%; width: 100%; height: 3px; background: #e5e7eb; z-index: -1; }
        .step-item:first-child::before { display: none; }
        .step-circle { width: 34px; height: 34px; border-radius: 50%; background: #e5e7eb; color: #9ca3af; display: flex; align-items: center; justify-content: center; font-weight: bold; transition: 0.3s; border: 3px solid #fff; }
        .step-active .step-circle { background: #16a34a; color: white; box-shadow: 0 0 0 4px #dcfce7; }
        .step-active::before { background: #16a34a; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="border-b border-gray-100 py-4 sticky top-0 bg-white/90 backdrop-blur z-50">
        <div class="max-w-5xl mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-black text-white rounded-lg flex items-center justify-center font-bold text-lg">Q</div>
                <span class="font-bold text-xl tracking-tight">Service Store</span>
            </div>
            <div id="nav-actions">
                </div>
        </div>
    </nav>

    <main id="app" class="flex-1 max-w-3xl mx-auto w-full p-6 mt-4">
        
        <section id="auth-section" class="hidden text-center animate__animated animate__fadeIn">
            <h1 class="text-3xl font-bold mb-2">‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡πÄ‡∏ß‡πá‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</h1>
            <p class="text-gray-500 mb-8">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
            
            <div class="bg-white border border-gray-200 p-8 rounded-2xl shadow-sm max-w-sm mx-auto">
                <div id="form-login">
                    <input id="l-email" class="input-box w-full p-3 mb-3" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                    <input id="l-pass" type="password" class="input-box w-full p-3 mb-6" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <button onclick="Auth.login()" class="btn-primary w-full py-3 font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <p class="mt-4 text-sm text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="#" onclick="View.toggleAuth('reg')" class="text-blue-600 font-bold">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a></p>
                </div>
                <div id="form-register" class="hidden">
                    <input id="r-name" class="input-box w-full p-3 mb-3" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                    <input id="r-email" class="input-box w-full p-3 mb-3" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                    <input id="r-pass" type="password" class="input-box w-full p-3 mb-6" placeholder="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <button onclick="Auth.register()" class="btn-primary w-full py-3 font-bold">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                    <p class="mt-4 text-sm text-gray-400">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href="#" onclick="View.toggleAuth('log')" class="text-blue-600 font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a></p>
                </div>
            </div>
        </section>

        <section id="dash-section" class="hidden animate__animated animate__fadeIn">
            <div class="flex justify-between items-end mb-8">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span id="user-name">User</span></h2>
                    <p class="text-gray-500 text-sm">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                </div>
                <button onclick="Auth.logout()" class="text-sm text-red-500 font-bold bg-red-50 px-4 py-2 rounded-lg hover:bg-red-100 transition">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>

            <div id="order-container">
                </div>

            <a href="https://m.me/YOUR_FB_ID" target="_blank" class="mt-8 block bg-blue-50 border border-blue-100 p-4 rounded-xl flex items-center justify-between hover:bg-blue-100 transition group cursor-pointer text-decoration-none">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg"><i class="fa-brands fa-facebook-messenger"></i></div>
                    <div>
                        <div class="font-bold text-blue-900 group-hover:text-blue-700">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>
                        <div class="text-xs text-blue-600">‡∏ó‡∏±‡∏Å‡πÅ‡∏ä‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
                    </div>
                </div>
                <i class="fa-solid fa-chevron-right text-blue-300"></i>
            </a>
        </section>

    </main>

    <script>
        // --- ‡πÉ‡∏™‡πà Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ---
        const firebaseConfig = {
            apiKey: "AIzaSyAHAkBhypqyJuuL22tLrFKN7ZqdEsqGDTk",
            authDomain: "rsdm-9ca2a.firebaseapp.com",
            projectId: "rsdm-9ca2a",
            storageBucket: "rsdm-9ca2a.firebasestorage.app",
            messagingSenderId: "299212700124",
            appId: "1:299212700124:web:730160dae6bb1b09cbb719"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const View = {
            toggleAuth: (mode) => {
                document.getElementById('form-login').classList.toggle('hidden', mode === 'reg');
                document.getElementById('form-register').classList.toggle('hidden', mode === 'log');
            },
            showDash: (user) => {
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('dash-section').classList.remove('hidden');
                document.getElementById('user-name').innerText = user.displayName || '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤';
                App.loadOrder(user.uid);
            },
            showAuth: () => {
                document.getElementById('auth-section').classList.remove('hidden');
                document.getElementById('dash-section').classList.add('hidden');
            },
            renderOrderForm: () => {
                document.getElementById('order-container').innerHTML = `
                    <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                        <h3 class="font-bold text-lg mb-4">üìù ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</h3>
                        <div class="space-y-4">
                            <div><label class="text-xs font-bold text-gray-500 ml-1">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô / ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</label><input id="ord-shop" class="input-box w-full p-3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏´‡∏°‡∏≠‡πÉ‡∏à‡∏î‡∏µ"></div>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="text-xs font-bold text-gray-500 ml-1">Email ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label><input id="ord-adm-email" class="input-box w-full p-3" placeholder="admin@shop.com"></div>
                                <div><label class="text-xs font-bold text-gray-500 ml-1">Password ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label><input id="ord-adm-pass" class="input-box w-full p-3" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"></div>
                            </div>
                            <button onclick="App.createOrder()" class="btn-primary w-full py-4 text-lg font-bold shadow-lg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡πÄ‡∏ß‡πá‡∏ö</button>
                        </div>
                    </div>`;
            },
            renderStatus: (data) => {
                const steps = ['pending', 'working', 'testing', 'completed'];
                const labels = ['‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥', '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö', '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'];
                const currentIdx = steps.indexOf(data.status);
                
                let timeline = '<div class="flex justify-between w-full mt-6 px-2">';
                labels.forEach((label, i) => {
                    const active = i <= currentIdx ? 'step-active' : '';
                    const icon = i < currentIdx ? '<i class="fa-solid fa-check"></i>' : (i === currentIdx ? (i===3 ? '<i class="fa-solid fa-check"></i>' : (i===0?'1':(i===1?'<i class="fa-solid fa-hammer"></i>':'<i class="fa-solid fa-magnifying-glass"></i>'))) : i+1);
                    timeline += `<div class="step-item ${active}"><div class="step-circle z-10">${icon}</div><div class="text-xs mt-2 font-bold ${active?'text-green-600':'text-gray-400'}">${label}</div></div>`;
                });
                timeline += '</div>';

                let footer = '';
                if(data.status === 'completed') {
                    footer = `<div class="mt-6 bg-green-50 border border-green-200 text-green-700 p-4 rounded-xl text-center">
                        <i class="fa-solid fa-circle-check text-2xl mb-2"></i><br><b>‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!</b><br>‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏ä‡∏ó
                    </div>`;
                } else {
                    footer = `<div class="mt-6 text-center text-sm text-gray-400 animate-pulse">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</div>`;
                }

                document.getElementById('order-container').innerHTML = `
                    <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
                        <div class="flex justify-between items-start mb-2">
                            <div><div class="text-xs text-gray-400 font-bold uppercase">Project</div><div class="text-xl font-bold text-gray-800">${data.shopName}</div></div>
                            <span class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-xs font-bold">${new Date(data.timestamp.toDate()).toLocaleDateString()}</span>
                        </div>
                        <div class="text-sm text-gray-500 mb-4 border-b border-gray-100 pb-4">Admin: ${data.adminEmail}</div>
                        ${timeline}
                        ${footer}
                    </div>`;
            }
        };

        const Auth = {
            login: () => auth.signInWithEmailAndPassword(document.getElementById('l-email').value, document.getElementById('l-pass').value).catch(e=>Swal.fire('Error',e.message,'error')),
            register: () => {
                const n=document.getElementById('r-name').value, e=document.getElementById('r-email').value, p=document.getElementById('r-pass').value;
                auth.createUserWithEmailAndPassword(e,p).then(c=>{ c.user.updateProfile({displayName:n}); Swal.fire('Success','','success'); }).catch(err=>Swal.fire('Error',err.message,'error'));
            },
            logout: () => auth.signOut().then(()=>location.reload())
        };

        const App = {
            loadOrder: (uid) => {
                db.collection('web_orders').where('uid','==',uid).limit(1).onSnapshot(snap => {
                    if(snap.empty) View.renderOrderForm();
                    else View.renderStatus(snap.docs[0].data());
                });
            },
            createOrder: () => {
                const u = auth.currentUser;
                const shop = document.getElementById('ord-shop').value;
                const admE = document.getElementById('ord-adm-email').value;
                const admP = document.getElementById('ord-adm-pass').value;
                if(!shop || !admE || !admP) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö','','warning');
                
                db.collection('web_orders').add({
                    uid: u.uid, customerName: u.displayName, shopName: shop, adminEmail: admE, adminPass: admP,
                    status: 'pending', timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(()=> Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£','success'));
            }
        };

        auth.onAuthStateChanged(user => user ? View.showDash(user) : View.showAuth());
    </script>
</body>
</html>
