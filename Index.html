<!DOCTYPE html>
<html lang="th" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Customer | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõçÔ∏è</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/th.js"></script>
    <script>dayjs.locale('th');</script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Kanit', 'Inter', 'sans-serif'] },
                    colors: {
                        brand: { 50: '#eef2ff', 100: '#e0e7ff', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 900: '#312e81' },
                        dark: { bg: '#0f172a', card: '#1e293b', text: '#f1f5f9', border: '#334155' }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer components {
            body { @apply bg-slate-50 text-slate-800 dark:bg-dark-bg dark:text-dark-text transition-colors duration-300; }
            .card-panel { @apply bg-white dark:bg-dark-card border border-slate-200 dark:border-dark-border rounded-2xl shadow-sm p-6 transition-all; }
            .input-field { @apply w-full px-4 py-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-dark-border rounded-xl outline-none focus:ring-2 focus:ring-brand-500/50 focus:border-brand-500 transition-all; }
            .btn-primary { @apply bg-brand-600 hover:bg-brand-700 text-white px-6 py-3 rounded-xl font-semibold shadow-lg shadow-brand-500/30 active:scale-95 transition-all flex items-center justify-center gap-2; }
            .status-badge { @apply text-[10px] uppercase font-bold px-3 py-1 rounded-full tracking-wider; }
            .glass-effect { @apply bg-white/80 dark:bg-dark-card/80 backdrop-blur-md; }
            
            /* Status Colors */
            .st-pending { @apply bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400; }
            .st-working { @apply bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400; }
            .st-testing { @apply bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400; }
            .st-completed { @apply bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400; }
            .st-cancelled { @apply bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400; }

            /* Timeline */
            .timeline-item { @apply flex flex-col items-center relative z-10 w-1/4; }
            .timeline-dot { @apply w-8 h-8 rounded-full border-4 border-slate-200 bg-white dark:border-slate-700 dark:bg-slate-800 flex items-center justify-center text-xs text-slate-300 transition-all duration-500; }
            .timeline-text { @apply text-xs font-bold mt-2 text-slate-400 dark:text-slate-500 transition-all duration-500; }
            .timeline-line { @apply absolute top-4 left-0 w-full h-1 bg-slate-200 dark:bg-slate-700 z-0; }
            .timeline-progress { @apply h-full bg-brand-500 transition-all duration-1000 ease-out; }
            
            /* Active Timeline */
            .active .timeline-dot { @apply border-brand-500 bg-brand-500 text-white shadow-lg shadow-brand-500/40 transform scale-110; }
            .active .timeline-text { @apply text-brand-600 dark:text-brand-400; }
            .completed .timeline-dot { @apply border-brand-500 bg-brand-500 text-white; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-100 dark:bg-dark-bg p-4">
        <div class="bg-white dark:bg-dark-card w-full max-w-md rounded-3xl shadow-2xl overflow-hidden border border-slate-200 dark:border-dark-border animate__animated animate__zoomIn">
            <div class="h-2 bg-gradient-to-r from-brand-500 to-purple-600"></div>
            <div class="p-8">
                <div class="text-center mb-8">
                    <div class="inline-flex w-16 h-16 bg-brand-50 dark:bg-brand-900/30 text-brand-600 dark:text-brand-400 rounded-2xl items-center justify-center text-3xl mb-4 shadow-sm">
                        <i class="fa-solid fa-store"></i>
                    </div>
                    <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-brand-600 to-purple-600">Q-Customer Service</h1>
                    <p class="text-slate-500 dark:text-slate-400 text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                </div>

                <div id="form-login" class="space-y-4">
                    <input id="login-email" class="input-field" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
                    <input id="login-pass" type="password" class="input-field" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <button onclick="Auth.login()" class="btn-primary w-full shadow-brand-500/40">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <p class="text-center text-sm text-slate-500 mt-4">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="#" onclick="UI.toggleAuth('register')" class="text-brand-600 font-bold hover:underline">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
                    </p>
                </div>

                <div id="form-register" class="space-y-4 hidden">
                    <input id="reg-name" class="input-field" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠)">
                    <input id="reg-email" class="input-field" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                    <input id="reg-pass" type="password" class="input-field" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <button onclick="Auth.register()" class="btn-primary w-full bg-purple-600 hover:bg-purple-700 shadow-purple-500/40">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                    <p class="text-center text-sm text-slate-500 mt-4">
                        ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href="#" onclick="UI.toggleAuth('login')" class="text-brand-600 font-bold hover:underline">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div id="app-screen" class="hidden flex flex-col min-h-screen">
        
        <nav class="h-16 glass-effect sticky top-0 z-40 border-b border-slate-200 dark:border-dark-border px-4 lg:px-8 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-gradient-to-br from-brand-500 to-purple-600 text-white rounded-lg flex items-center justify-center shadow-lg shadow-brand-500/20">
                    <i class="fa-solid fa-shapes"></i>
                </div>
                <span class="font-bold text-lg text-slate-800 dark:text-white tracking-tight hidden md:inline">Q-Customer</span>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 text-right">
                    <div class="hidden md:block">
                        <div id="user-display-name" class="text-sm font-bold text-slate-700 dark:text-slate-200">User</div>
                        <div class="text-[10px] text-brand-500 font-bold uppercase">Customer Account</div>
                    </div>
                    <div class="w-9 h-9 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500"><i class="fa-solid fa-user"></i></div>
                </div>
                <button onclick="Theme.toggle()" class="w-9 h-9 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-yellow-400 flex items-center justify-center hover:bg-slate-200 dark:hover:bg-slate-700 transition"><i id="theme-icon" class="fa-solid fa-moon"></i></button>
                <button onclick="Auth.logout()" class="w-9 h-9 rounded-full bg-red-50 dark:bg-red-900/20 text-red-500 flex items-center justify-center hover:bg-red-100 transition"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </nav>

        <main class="flex-1 max-w-5xl mx-auto w-full p-4 lg:p-8 space-y-8">
            
            <div id="announcement-section" class="hidden animate__animated animate__fadeInDown">
                <div class="bg-gradient-to-r from-brand-600 to-purple-600 rounded-2xl p-6 text-white shadow-xl relative overflow-hidden">
                    <div class="absolute -right-10 -top-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
                    <div class="relative z-10 flex items-start gap-4">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center flex-shrink-0 animate-pulse"><i class="fa-solid fa-bullhorn"></i></div>
                        <div>
                            <h3 id="annc-title" class="font-bold text-lg mb-1">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h3>
                            <p id="annc-message" class="text-brand-100 text-sm leading-relaxed">...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-2">
                    <i class="fa-solid fa-box-open text-brand-500"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                </h2>
                <button onclick="UI.openCreateModal()" class="btn-primary text-sm shadow-brand-500/20">
                    <i class="fa-solid fa-plus"></i> ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <div id="orders-container" class="space-y-6">
                <div class="text-center py-20 text-slate-400">
                    <i class="fa-solid fa-circle-notch fa-spin text-3xl mb-4"></i>
                    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>
            </div>

        </main>
    </div>

    <div id="create-modal" class="fixed inset-0 bg-slate-900/80 z-50 flex items-center justify-center hidden backdrop-blur-sm p-4 animate__animated animate__fadeIn">
        <div class="bg-white dark:bg-dark-card w-full max-w-lg rounded-2xl shadow-2xl p-6 border border-slate-200 dark:border-dark-border">
            <h3 class="text-xl font-bold text-slate-800 dark:text-white mb-4">‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå / ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà</h3>
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-500 ml-1 mb-1 block">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå</label>
                    <input id="new-shop-name" class="input-field" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü Coffee A">
                </div>
                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl text-xs text-blue-700 dark:text-blue-300 flex gap-3 leading-relaxed">
                    <i class="fa-solid fa-info-circle text-lg mt-0.5"></i>
                    <div>
                        <span class="font-bold">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</span><br>
                        1. ‡∏Å‡∏î‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö<br>
                        2. ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤<br>
                        3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥"<br>
                        4. ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Email/Password ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="document.getElementById('create-modal').classList.add('hidden')" class="flex-1 py-3 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 font-bold transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="App.createOrder()" class="flex-1 btn-primary">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, query, where, orderBy, onSnapshot, addDoc, serverTimestamp, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Configuration (MUST MATCH ADMIN)
        const firebaseConfig = {
            apiKey: "AIzaSyAHAkBhypqyJuuL22tLrFKN7ZqdEsqGDTk",
            authDomain: "rsdm-9ca2a.firebaseapp.com",
            projectId: "rsdm-9ca2a",
            storageBucket: "rsdm-9ca2a.firebasestorage.app",
            messagingSenderId: "299212700124",
            appId: "1:299212700124:web:730160dae6bb1b09cbb719"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Theme Manager ---
        window.Theme = {
            init: () => {
                if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('theme-icon').classList.replace('fa-moon', 'fa-sun');
                }
            },
            toggle: () => {
                document.documentElement.classList.toggle('dark');
                const isDark = document.documentElement.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                document.getElementById('theme-icon').classList.replace(isDark ? 'fa-moon' : 'fa-sun', isDark ? 'fa-sun' : 'fa-moon');
            }
        };

        // --- Auth Logic ---
        window.Auth = {
            login: async () => {
                try {
                    const e = document.getElementById('login-email').value;
                    const p = document.getElementById('login-pass').value;
                    await signInWithEmailAndPassword(auth, e, p);
                } catch(err) { Swal.fire('Error', err.message, 'error'); }
            },
            register: async () => {
                try {
                    const n = document.getElementById('reg-name').value;
                    const e = document.getElementById('reg-email').value;
                    const p = document.getElementById('reg-pass').value;
                    if(!n || !e || !p) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'warning');
                    
                    const cred = await createUserWithEmailAndPassword(auth, e, p);
                    await updateProfile(cred.user, { displayName: n });
                    // Sync to users collection for Admin visibility
                    await setDoc(doc(db, "users", cred.user.uid), {
                        email: e, displayName: n, role: 'customer', createdAt: serverTimestamp()
                    });
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                } catch(err) { Swal.fire('Error', err.message, 'error'); }
            },
            logout: () => signOut(auth)
        };

        // --- UI Manager ---
        window.UI = {
            toggleAuth: (mode) => {
                document.getElementById('form-login').classList.toggle('hidden', mode === 'register');
                document.getElementById('form-register').classList.toggle('hidden', mode === 'login');
            },
            openCreateModal: () => {
                document.getElementById('new-shop-name').value = '';
                document.getElementById('create-modal').classList.remove('hidden');
            },
            renderOrderCard: (o) => {
                // Status Mapping
                const steps = ['pending', 'working', 'testing', 'completed'];
                const currentIdx = steps.indexOf(o.status);
                let progressWidth = 0;
                if(currentIdx === 0) progressWidth = 15;
                else if(currentIdx === 1) progressWidth = 50;
                else if(currentIdx === 2) progressWidth = 85;
                else if(currentIdx === 3) progressWidth = 100;
                if(o.status === 'cancelled') progressWidth = 0;

                const statusBadge = {
                    'pending': '<span class="status-badge st-pending"><i class="fa-solid fa-clock"></i> ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</span>',
                    'working': '<span class="status-badge st-working"><i class="fa-solid fa-hammer"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</span>',
                    'testing': '<span class="status-badge st-testing"><i class="fa-solid fa-vial"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>',
                    'completed': '<span class="status-badge st-completed"><i class="fa-solid fa-check-circle"></i> ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>',
                    'cancelled': '<span class="status-badge st-cancelled"><i class="fa-solid fa-ban"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>'
                }[o.status];

                // Credentials Box (Only if completed or admin filled it)
                let credsHtml = '';
                if(o.adminEmail || o.adminPass) {
                    credsHtml = `
                        <div class="mt-6 bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl border border-dashed border-slate-300 dark:border-slate-700 animate__animated animate__fadeIn">
                            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-2"><i class="fa-solid fa-key"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><div class="text-xs text-slate-500">Email/Username</div><div class="font-mono font-bold text-brand-600 dark:text-brand-400 select-all">${o.adminEmail || '-'}</div></div>
                                <div><div class="text-xs text-slate-500">Password</div><div class="font-mono font-bold text-brand-600 dark:text-brand-400 select-all">${o.adminPass || '-'}</div></div>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="card-panel relative overflow-hidden group">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800 dark:text-white">${o.shopName}</h3>
                                <div class="text-xs text-slate-400 mt-1">‡∏™‡∏±‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${dayjs(o.timestamp?.toDate()).format('D MMM YYYY HH:mm')}</div>
                            </div>
                            ${statusBadge}
                        </div>

                        <div class="relative mb-6 px-4">
                            <div class="timeline-line"><div class="timeline-progress" style="width: ${progressWidth}%"></div></div>
                            <div class="flex justify-between relative">
                                <div class="timeline-item ${currentIdx >= 0 ? 'active' : ''}">
                                    <div class="timeline-dot"><i class="fa-solid fa-inbox"></i></div>
                                    <div class="timeline-text">‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
                                </div>
                                <div class="timeline-item ${currentIdx >= 1 ? 'active' : ''}">
                                    <div class="timeline-dot"><i class="fa-solid fa-code"></i></div>
                                    <div class="timeline-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</div>
                                </div>
                                <div class="timeline-item ${currentIdx >= 2 ? 'active' : ''}">
                                    <div class="timeline-dot"><i class="fa-solid fa-bug"></i></div>
                                    <div class="timeline-text">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
                                </div>
                                <div class="timeline-item ${currentIdx >= 3 ? 'active' : ''}">
                                    <div class="timeline-dot"><i class="fa-solid fa-check"></i></div>
                                    <div class="timeline-text">‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</div>
                                </div>
                            </div>
                        </div>

                        ${credsHtml}
                    </div>
                `;
            }
        };

        // --- Main Logic ---
        window.App = {
            init: () => {
                Theme.init();
                onAuthStateChanged(auth, (user) => {
                    const authScreen = document.getElementById('auth-screen');
                    const appScreen = document.getElementById('app-screen');
                    
                    if(user) {
                        authScreen.classList.add('hidden');
                        appScreen.classList.remove('hidden');
                        document.getElementById('user-display-name').innerText = user.displayName || user.email;
                        App.loadData(user.uid);
                    } else {
                        authScreen.classList.remove('hidden');
                        appScreen.classList.add('hidden');
                    }
                });
            },
            createOrder: async () => {
                const name = document.getElementById('new-shop-name').value;
                if(!name) return Swal.fire('Error', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô', 'warning');
                
                try {
                    const user = auth.currentUser;
                    await addDoc(collection(db, "web_orders"), {
                        uid: user.uid,
                        customerName: user.displayName || user.email,
                        shopName: name,
                        status: 'pending',
                        timestamp: serverTimestamp(),
                        adminEmail: '', adminPass: '', adminNotes: '' // Initial empty fields
                    });
                    document.getElementById('create-modal').classList.add('hidden');
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                } catch(e) { Swal.fire('Error', e.message, 'error'); }
            },
            loadData: (uid) => {
                // 1. Announcements
                onSnapshot(query(collection(db, "system_announcements"), where("isActive", "==", true), orderBy("updatedAt", "desc")), (snap) => {
                    const section = document.getElementById('announcement-section');
                    if(!snap.empty) {
                        const data = snap.docs[0].data();
                        document.getElementById('annc-title').innerText = data.title;
                        document.getElementById('annc-message').innerText = data.message;
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });

                // 2. Orders
                onSnapshot(query(collection(db, "web_orders"), where("uid", "==", uid), orderBy("timestamp", "desc")), (snap) => {
                    const container = document.getElementById('orders-container');
                    if(snap.empty) {
                        container.innerHTML = `
                            <div class="text-center py-16 bg-white dark:bg-dark-card rounded-2xl border border-dashed border-slate-300 dark:border-dark-border">
                                <i class="fa-solid fa-folder-open text-4xl text-slate-300 mb-4"></i>
                                <p class="text-slate-500 dark:text-slate-400">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥</p>
                                <button onclick="UI.openCreateModal()" class="text-brand-600 font-bold mt-2 hover:underline">‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏¢!</button>
                            </div>`;
                    } else {
                        container.innerHTML = snap.docs.map(doc => UI.renderOrderCard({id: doc.id, ...doc.data()})).join('');
                    }
                });
            }
        };

        App.init();
    </script>
</body>
</html>
